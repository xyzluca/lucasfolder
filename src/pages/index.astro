---
import IndexLayout from '@/layouts/IndexLayout.astro'
import About from '@/components/widgets/About.astro'
import PostList from '@/components/widgets/PostList.astro'
import WorkExperience from '@/components/widgets/WorkExperience.astro'
import { themeConfig } from '@/config'
import { getSortedFilteredPosts } from '@/utils/draft'
import { getCollection } from 'astro:content'

const posts = await getSortedFilteredPosts()
const allProjects = await getCollection('projects')

// Filter out projects that start with _ (like posts)
const projects = allProjects.filter((project) => !project.id.startsWith('_'))

// Sort posts and projects separately, then combine with posts first
const sortedPosts = posts.sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime())
const sortedProjects = projects.sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime())
const allContent = [...sortedPosts, ...sortedProjects]
---

<IndexLayout title={themeConfig.site.title} description={themeConfig.site.description}>
  <About />

  <main>
    <h2>Thoughts</h2>
    <PostList posts={sortedPosts} />
  </main>

  <section class="work-section">
    <h2>Work</h2>
    <WorkExperience />
  </section>

  <section class="projects-section">
    <h2>Projects</h2>
    <PostList posts={sortedProjects} />
  </section>
</IndexLayout>

<style>
  .work-section,
  .projects-section {
    margin: 3rem 0;
  }

  h2 {
    font-size: var(--font-size-m);
    font-weight: var(--font-weight-bold);
    line-height: 1.75;
    margin: 2.75em 0 1.75em 0;
    color: var(--text-primary);
  }

  main h2 {
    margin-bottom: 1.75em;
  }
</style>
